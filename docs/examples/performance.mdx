---
title: "Use Case: Performance"
description: "Load the performance tools, verify with MCP Inspector, then run an example agent that examines job and memory performance."
---

# Use Case: Performance

This guide uses the actual SQL tools from `prebuiltconfigs/performance.yaml` to analyze IBM i performance. You will load the YAML, verify with MCP Inspector, and run an example agent.

## The SQL we want to use

```sql
-- Overall system performance
SELECT * FROM TABLE(QSYS2.SYSTEM_STATUS(
  RESET_STATISTICS=>'YES',
  DETAILED_INFO=>'ALL'
)) X;

-- System activity
SELECT * FROM TABLE(QSYS2.SYSTEM_ACTIVITY_INFO());

-- Top CPU consumers in key subsystems (parameterized limit)
SELECT CPU_TIME, A.*
FROM TABLE(QSYS2.ACTIVE_JOB_INFO(
  SUBSYSTEM_LIST_FILTER => 'QUSRWRK,QSYSWRK'
)) A
ORDER BY CPU_TIME DESC
FETCH FIRST :limit ROWS ONLY;

-- Memory pools
SELECT POOL_NAME, CURRENT_SIZE, DEFINED_SIZE,
       MAXIMUM_ACTIVE_THREADS, CURRENT_THREADS, RESERVED_SIZE
FROM TABLE(QSYS2.MEMORY_POOL(RESET_STATISTICS=>'YES')) X;

-- Collection Services status and categories
SELECT * FROM QSYS2.COLLECTION_SERVICES_INFO;
SELECT cs_category, cs_interval
FROM QSYS2.COLLECTION_SERVICES_INFO,
     LATERAL (
       SELECT * FROM JSON_TABLE(CATEGORY_LIST, 'lax $.category_list[*]'
         COLUMNS(
           cs_category CLOB(1K) CCSID 1208 PATH 'lax $."category"',
           cs_interval CLOB(1K) CCSID 1208 PATH 'lax $."interval"'
         )
       )
     ) a;
```

## YAML configuration mapping

Create a minimal YAML that maps those statements into tools. You can place this alongside the prebuilt configs or use the prebuilt file directly.

```yaml
sources:
  ibmi-system:
    host: ${DB2i_HOST}
    user: ${DB2i_USER}
    password: ${DB2i_PASS}
    port: ${DB2i_PORT:-8076}
    ignore-unauthorized: ${DB2i_IGNORE_UNAUTHORIZED:-true}

tools:
  system_status:
    source: ibmi-system
    description: "Overall system performance metrics"
    parameters: []
    statement: |
      SELECT * FROM TABLE(QSYS2.SYSTEM_STATUS(
        RESET_STATISTICS=>'YES',
        DETAILED_INFO=>'ALL'
      )) X

  system_activity:
    source: ibmi-system
    description: "Detailed activity metrics"
    parameters: []
    statement: |
      SELECT * FROM TABLE(QSYS2.SYSTEM_ACTIVITY_INFO())

  active_job_info:
    source: ibmi-system
    description: "Top CPU consumers in QUSRWRK/QSYSWRK"
    parameters:
      - name: limit
        type: integer
        default: 10
        description: "Number of top CPU consumers"
    statement: |
      SELECT CPU_TIME, A.* FROM 
      TABLE(QSYS2.ACTIVE_JOB_INFO(SUBSYSTEM_LIST_FILTER => 'QUSRWRK,QSYSWRK')) A 
      ORDER BY CPU_TIME DESC 
      FETCH FIRST :limit ROWS ONLY

  memory_pools:
    source: ibmi-system
    description: "Memory pool sizes and threads"
    parameters: []
    statement: |
      SELECT POOL_NAME, CURRENT_SIZE, DEFINED_SIZE,
             MAXIMUM_ACTIVE_THREADS, CURRENT_THREADS, RESERVED_SIZE
      FROM TABLE(QSYS2.MEMORY_POOL(RESET_STATISTICS=>'YES')) X

  collection_services:
    source: ibmi-system
    description: "Collection Services status"
    parameters: []
    statement: |
      SELECT * FROM QSYS2.COLLECTION_SERVICES_INFO

  collection_categories:
    source: ibmi-system
    description: "Collection Services categories and intervals"
    parameters: []
    statement: |
      SELECT cs_category, cs_interval
      FROM QSYS2.COLLECTION_SERVICES_INFO,
           LATERAL (SELECT * FROM JSON_TABLE(CATEGORY_LIST, 'lax $.category_list[*]'
             COLUMNS(
               cs_category CLOB(1K) CCSID 1208 PATH 'lax $."category"',
               cs_interval CLOB(1K) CCSID 1208 PATH 'lax $."interval"'
             )
           )) a

toolsets:
  performance:
    description: "Performance analysis tools"
    tools:
      - system_status
      - system_activity
      - active_job_info
      - memory_pools
      - collection_services
      - collection_categories
```

## 1) Load the performance tools

```bash
# Ensure the prebuilt directory is included
TOOLS_YAML_PATH=prebuiltconfigs

npm run build
npm run start:http   # or start:stdio
```

Optional: validate the YAML files

```bash
npm run validate -- --tools-dir prebuiltconfigs
```

## 2) Verify with MCP Inspector

```bash
npm run inspector
```

In the UI, select your server and verify these tools execute with `{}`:

- system_status — Overall CPU/memory/I/O
- system_activity — Activity and rates
- memory_pools — Pool sizes and threads
- collection_services — Collection Services status
- collection_categories — Category settings and intervals

You should see structured rows for each query.

Optional (HTTP JSON‑RPC example):

```bash
curl -sS -X POST http://127.0.0.1:3010/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "tools/call",
    "params": { "name": "active_job_info", "arguments": { "limit": 10 } }
  }'
```

## 3) Run an example agent

Use the provided test agent to summarize current performance.

```bash
cd tests/agents
uv run agent.py -p "Summarize system performance using active_job_info, memory_pools, and collection_services"
```

Tips
- Use a targeted prompt: “Identify top CPU consumers and memory pools with high utilization.”
- Explore `list_tool_annotations.py` to see tool metadata and parameters.

## 4) Extend

- Add a parameterized limit to long-running lists (Db2 for i syntax: `FETCH FIRST ? ROWS ONLY`)
- Create a `toolsets: { performance: { tools: [...] } }` grouping
- Add dashboards or alerts by composing multiple tools in your agent
